(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.elementorySupport=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){"use strict";var elementorySupportFactory=require("./with-xhr");module.exports=elementorySupportFactory()},{"./with-xhr":3}],2:[function(require,module,exports){"use strict";module.exports={PARSE:"parsererror",ERROR:"error",ABORT:"abort",TIMEOUT:"timeout"}},{}],3:[function(require,module,exports){"use strict";var _extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},wireFormat=require("../common/wire-format"),getPathWithBaseUrl=require("../common/paths"),executeConsoleLogs=require("../common/execute-console-logs"),errorTypes=require("./error-types"),THIRTY_SECONDS=3e4;module.exports=function(e,r,t){return{baseUrl:e,queryParameters:r,currentPath:t,options:arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},errorTypes:errorTypes,wireFormatParser:wireFormat.wireFormatParser,getJSON:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=this.currentPath?location.href.replace(this.currentPath,e):getPathWithBaseUrl(this.baseUrl,e,this.queryParameters),o=this.options,s=o.headers,a=void 0===s?{}:s,n=o.withCredentials,i=void 0!==n&&n,u=o.timeout,c=void 0===u?THIRTY_SECONDS:u,h=_extends({},a,{"Content-Type":"application/json"});return new Promise(function(e,o){var s=new XMLHttpRequest;s.withCredentials=i;var a=setTimeout(function(){o(n(errorTypes.TIMEOUT)),s.abort()},c);function n(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=new Error(r);return t.xhr=s,t.errorType=e,t}s.open("POST",t,!0),s.onerror=function(){return o(n(errorTypes.ERROR,s.statusText))},s.onreadystatechange=function(){if(4===s.readyState)if(clearTimeout(a),200===s.status)try{var r=wireFormat.fromJson(s.responseText);executeConsoleLogs(r.consoleMethodCalls);var t=r.isError,i=r.payload;t?o(i):e(i)}catch(e){o(n(errorTypes.PARSE,e.message))}else{var u=s.status?errorTypes.ERROR:errorTypes.ABORT;o(n(u,s.statusText))}},Object.keys(h).forEach(function(e){return s.setRequestHeader(e,h[e])}),s.send(wireFormat.toArgsFormat(r))})}}}},{"../common/execute-console-logs":4,"../common/paths":5,"../common/wire-format":9,"./error-types":2}],4:[function(require,module,exports){"use strict";module.exports=function(o){for(var e=0;e<o.length;++e){var r=o[e];console.serverLog?console.serverLog(r):console[r[0]](r[1])}}},{}],5:[function(require,module,exports){"use strict";module.exports=function(t,s,r){return r?((r.startsWith("?")||r.startsWith("&"))&&(r=r.substr(1)),r=-1===s.indexOf("?")?"?"+r:"&"+r,t+s+r):t+s}},{}],6:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,r){for(var i=0;i<r.length;i++){var t=r[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,i,t){return i&&e(r.prototype,i),t&&e(r,t),r}}();function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _require=require("./values-mapper"),mapValues=_require.mapValues,DefaultSerializer=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"canSerialize",value:function(){return!0}},{key:"serialize",value:function(e,r){return r&&void 0===e?null:e}},{key:"canDeserialize",value:function(){return!0}},{key:"deserialize",value:function(e){return e}}]),e}();function isAnObjectButNotNull(e){return null!==e&&"object"===(void 0===e?"undefined":_typeof(e))}module.exports=function(){function e(){_classCallCheck(this,e);for(var r=arguments.length,i=Array(r),t=0;t<r;t++)i[t]=arguments[t];this.serializers=[].concat(i,[new DefaultSerializer])}return _createClass(e,[{key:"serialize",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(isAnObjectButNotNull(e)){if(r.has(e))throw new TypeError("Converting circular structure to JSON");r.add(e)}if(Array.isArray(e))return this._serializeArray(e,r);var t=this.findSerializer(e).serialize(e,i);return isAnObjectButNotNull(e)?this._serializeObject(t,e,r):t}},{key:"_serializeObject",value:function(e,r,i){var t=this,n=void 0;return n="function"==typeof e.toJSON?mapValues(e.toJSON(),function(e){return t.serialize(e,i)}):mapValues(e,function(e){return t.serialize(e,i)}),i.delete(r),n}},{key:"_serializeArray",value:function(e,r){var i=this,t=e.map(function(e){return i.serialize(e,r,!0)});return r.delete(e),t}},{key:"deserialize",value:function(e){var r=this,i=e;return Array.isArray(e)?i=e.map(function(e){return r.deserialize(e)}):isAnObjectButNotNull(e)&&(i=mapValues(e,this.deserialize.bind(this))),this.findDeserializer(i).deserialize(i)}},{key:"findDeserializer",value:function(e){return this.serializers.find(function(r){return r.canDeserialize(e)})}},{key:"findSerializer",value:function(e){return this.serializers.find(function(r){return r.canSerialize(e)})}}]),e}()},{"./values-mapper":8}],7:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var OBJECT_TAG_FIELD="__ctorName";exports.DateSerializer=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"canSerialize",value:function(e){return e instanceof Date}},{key:"serialize",value:function(e){return{$date:e.toISOString()}}},{key:"canDeserialize",value:function(e){return e&&"object"===(void 0===e?"undefined":_typeof(e))&&"$date"in e}},{key:"deserialize",value:function(e){return new Date(e.$date)}}]),e}(),exports.ObjectTaggingSerializer=function(){function e(t){_classCallCheck(this,e),this.className=t.name,this.classConstructor=t}return _createClass(e,[{key:"canSerialize",value:function(e){return e&&e[OBJECT_TAG_FIELD]===this.className}},{key:"serialize",value:function(e){return Object.assign(e.toJSON(),_defineProperty({},OBJECT_TAG_FIELD,this.className))}},{key:"canDeserialize",value:function(e){return e&&e[OBJECT_TAG_FIELD]===this.className}},{key:"deserialize",value:function(e){return this.classConstructor.fromJSON(e)}}]),e}()},{}],8:[function(require,module,exports){"use strict";function mapValues(a,e){var r={};return Object.keys(a).forEach(function(s){var t=e(a[s]);void 0!==t&&(r[s]=t)}),r}exports.mapValues=mapValues},{}],9:[function(require,module,exports){"use strict";function _toConsumableArray(r){if(Array.isArray(r)){for(var e=0,i=Array(r.length);e<r.length;e++)i[e]=r[e];return i}return Array.from(r)}var SerializerRegistry=require("./serializer-registry"),_require=require("./serializers"),DateSerializer=_require.DateSerializer,ObjectTaggingSerializer=_require.ObjectTaggingSerializer,_require2=require("wix-data-webmethod-structures"),Ref=_require2.Ref,registry=new SerializerRegistry(new DateSerializer,new ObjectTaggingSerializer(Ref));exports.wireFormatParser=function(r){return registry.deserialize(r)},exports.fromJson=function(r){var e=JSON.parse(r),i=exports.wireFormatParser(e);return{consoleMethodCalls:i.consoleMethodCalls||[],isError:!!i.exception,payload:function(r){if(!r)return r;if(r._elementoryError){var e=new Error(r.message);return e.stack=r.stack,e.name=r.name,e.code=r.code,e}return r}(i.result)}},exports.toJson=function(r){return registry.serialize(r)},exports.toArgsFormat=function(r){return r&&"[object Arguments]"===Object.prototype.toString.call(r)?JSON.stringify(registry.serialize([].concat(_toConsumableArray(r)))):JSON.stringify([])}},{"./serializer-registry":6,"./serializers":7,"wix-data-webmethod-structures":10}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Ref=function(){function e(t){_classCallCheck(this,e),this.__ctorName="Ref",this._id=null,this._item=null,"string"==typeof t?this._id=t:null!=t&&"object"==typeof t&&t.hasOwnProperty("_id")&&(this._id=t._id,this._item=t)}return _createClass(e,[{key:"get",value:function(){return this._item}},{key:"toJSON",value:function(){return this._item?{ref:this._id,item:this._item}:{ref:this._id}}},{key:"id",get:function(){return this._id}}],[{key:"fromJSON",value:function(t){var i=new e(t.ref);return i._item=t.item||null,i}}]),e}();exports.Ref=Ref},{}]},{},[1])(1)});