define("mediaRichText",["lodash","utils","core","santaProps","coreUtils","compUtils","create-react-class","textCommon"],function(e,t,n,i,o,r,a,s){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1536)}({0:function(t,n){t.exports=e},1:function(e,n){e.exports=t},13:function(e,t){e.exports=r},1536:function(e,t,n){var i,o;i=[n(0),n(2),n(1),n(4),n(13),n(18),n(3),n(37),n(1537),n(1539),n(1540)],void 0===(o=function(e,t,n,i,o,r,a,s,p,c,l){"use strict";var m=r({displayName:"wixMusicEmbed",mixins:[l],render:function(){return t.createReactElement("iframe",f(this.getIframeProps()))}}),u=i.fragment,d=s.textComponentsUtils,h={wline:"div"};function y(e,t){try{return function(e,t){var n=JSON.parse(e.replace(/&quot;/g,'"'));return n.url=t,n}(e,t)}catch(t){return void this.props.siteAPI.reportBI(p.MEDIA_RICH_TEXT_WRONG_COMP_DATA,{wixCompJson:e,errorDesc:t.message,errorStack:t.stack})}}function f(t){return e.assign(t,{wixComp:!0})}function g(t){return e.isFunction(t.type)&&t.props.wixComp}function v(e){return e.replace(/^#/,"")}function w(t){var n=this.props.siteData,i=this.props.id,o=function(t,n){var i=e.get(t,"structure.layout",{});return i.width&&(i.width=Math.min(n,i.width)),e.assign({},t.structure,{dataItem:t.compData,propertiesItem:t.compProp,layout:i,id:t.structure.id,type:t.structure.componentType,structure:t.structure})}(t,this._getMediaRichTextComponentWidth()),r=o.id;n.registerMediaRichTextInnerComponent(i,r,o)}var C={displayName:"MediaRichText",mixins:[s.textCompMixin],propTypes:{rootNavigationInfo:a.Types.Component.rootNavigationInfo.isRequired},allowIframes:!0,convertCompDataTextToHTML:function(t){this.componentDataQueryList=e.map(t.compData.componentDataList||[],v),this._compData=t.compData,this._componentHtml=this._componentHtml.replace(/\n|\r|\t/g,""),this._componentHtml=d.convertDataQueryLinksIntoHtmlAnchors(this._componentHtml,t.compData.linkList,e.partialRight(n.linkRenderer.renderLink,t.siteData,t.rootNavigationInfo)),this._componentHtml=d.mobileTextTransformIfNeeded(this._componentHtml,{brightness:e.get(t,"compProp.brightness"),isMobileView:t.siteData.isMobileView(),scale:e.get(t,"structure.layout.scale"),fontGetter:t.siteData.getFont.bind(t.siteData),colorGetter:t.siteData.getColor.bind(t.siteData)}),this.renderedDataQueries={},this._componentHtml=this._convertComponentsPlaceHoldersToRenderedComponents(this._componentHtml),e.size(this.renderedDataQueries)!==e.size(this.componentDataQueryList)&&e(this.componentDataQueryList).without(e.keys(this.renderedDataQueries)).forEach(function(e){this.props.siteAPI.reportBI(p.MEDIA_RICH_MISSING_COMPONENT_PLACEHOLDER,{dataQuery:"#"+e})}.bind(this)),this._registerReLayoutFunc=t.registerReLayout},_addToCompDataListIfMissing:function(t){var n=v(t);e.includes(this.componentDataQueryList,n)||this.componentDataQueryList.push(n)},_convertNodeFragmentToReactElements:function(n,i){if(n.nodeType===u.Node.ELEMENT_NODE){var o=e.reduce(n.attributes,function(t,n){return"style"===n.name?t.style=e.reduce(n.value.split(";"),function(t,n){var i=n.split(":");return 2===i.length&&(t[e.camelCase(i[0])]=i[1]),t},{}):"class"===n.name?t.className=n.value:"frameborder"===n.name?t.frameBorder=n.value:e.startsWith(n.name,"data-")?t[n.name]=n.value:t[e.camelCase(n.name)]=n.value,t},{});if(function(t,n){return t&&!e.has(h,n.tagName.toLowerCase())}(o.wixComp,n)){var r=y.call(this,o.wixComp,o.src);return r?this._handleInnerComps(r,o):""}var a=function(e){return e.childNodes&&1===e.childNodes.length&&e.childNodes[0].nodeType===u.Node.TEXT_NODE}(n)?n.textContent:e.flatMap(n.childNodes,this._convertNodeFragmentToReactElements);if(e.isArray(a)&&a.length&&e.every(a,g))return a;var s=e.includes(this.voidElements,n.tagName.toLowerCase())?o:e.assign(o,{children:a});return t.createReactElement(function(e){return h[e]||e}(n.tagName.toLowerCase()),e.defaults(s,{key:""+n.tagName+i}))}return n.nodeType===u.Node.TEXT_NODE?n.textContent:""},voidElements:["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","isindex","keygen","link","menuitem","meta","nextid","param","source","track","wbr"],_convertComponentsPlaceHoldersToRenderedComponents:function(t){var n=u.document.createElement("div");return n.innerHTML=t,e.map(n.childNodes,this._convertNodeFragmentToReactElements)},_validateAndFixGalleryCompData:function(t,n){var i=e.clone(t),o=c.buildGalleryJsonFromCkData(n,this._compData.innerCompsData,t.style);return e.assign(i,o),function(t){var n=e.cloneDeep(t.compData);t.compData.items=e.map(t.compData.items,function(t){return e.assign({galleryData:n},t)})}(i),i},_createInnerComponentProperties:function(t,n){var i=this._createInnerComponentBasicProperties(t,n);return"wysiwyg.viewer.components.WPhoto"===n.componentType||"wysiwyg.viewer.components.Video"===n.componentType?function(t,n){return e.has(t,"post-cover-photo")&&(n.addItemProp=!0),n}(n,i):c.isGalleryComponent(n.componentType)?this._validateAndFixGalleryCompData(i,n):(this.props.siteAPI.reportBI(p.MEDIA_RICH_TEXT_UNSUPPORTED_COMPONENT,{wixCompJson:n}),i)},_getMediaRichTextComponentWidth:function(){return function(){var e=this.props.siteData.measureMap;return e&&(this._lastMeasuredWidth=e.width[this.props.id]),this._lastMeasuredWidth}.call(this)||e.get(this.props,"style.width")||630},_createInnerComponentBasicProperties:function(t,n){var i=function(t){var n=t.id||function(e){return"innerComp_"+e.replace("#","")}(t.dataQuery);return e.assign(t,{id:n})}(n),o=e.get(this._compData.innerCompsData,i.dataQuery),r=void 0;if("wysiwyg.viewer.components.WPhoto"===i.componentType){if(i.linkDataQuery){var s=i.linkDataQuery.slice(1);o.link=e.find(this._compData.linkList,{id:s})}r={displayMode:"fitWidthStrict"}}else"wysiwyg.viewer.components.Video"===i.componentType&&(r={showControls:"temp_show",enablejsapi:1});var p=a.componentPropsBuilder.getCompProps(t,i,this.props.siteAPI,this.props.rootId,null,{compData:o,compProp:r});return p.key=p.key||n.key,delete p.ref,p.registerReLayout=this._registerReLayoutFunc||this.registerReLayout,function(e,t){var n=e.style;n.marginTop="10px",n.marginBottom="10px",n.marginLeft=t.marginLeft,n.marginRight=t.marginRight,n.position="static"}(p,i),function(e,t){var n=t.style;e.floatValue?(n.float=e.floatValue,n.display="",n.clear=""):(n.display=e.display,n.clear="both",n.float="")}(i,p),this._calcInnerCompWidthAndHeight(i,p),p},_calcInnerCompWidthAndHeight:function(t,n){var i=this._getMediaRichTextComponentWidth(),o=i,r=n.compData&&n.compData.width,a=t.width;e.isNumber(a)?o=this._getWidthMultiplier(t)*i:e.isNumber(r)&&(o=Math.min(r,i)),n.style.width=o,t.dimsRatio?n.style.height=n.style.width*t.dimsRatio:"wysiwyg.viewer.components.Video"===t.componentType&&(n.style.height=.5625*n.style.width)},_getWidthMultiplier:function(e){return this.props.siteData.isMobileView()?.99:e.width},_handleInnerComps:function(e,t){return"htmlComp"===e.componentType?this._handleHtmlComp(e,t):"music"===e.componentType?this._handleMusicComp(e,t):this._handleInnerSantaComponent(e)},_handleInnerSantaComponent:function(e){var t=o.compFactory.getCompReactClass(e.componentType),n=this._createInnerComponentProperties(t,e);return this.renderedDataQueries[v(e.dataQuery)]=1,this._addToCompDataListIfMissing(e.dataQuery),w.call(this,n),o.compFactory.getCompClass(e.componentType,!0)(f(n))},_handleHtmlComp:function(e,n){var i=this.props.siteData.serviceTopology.staticHTMLComponentUrl,o=void 0;"website"===e.type?o="//"+function(e){return e.replace(/^(https?:)?\/\//,"")}(e.websiteUrl):o=("temp"===e.urlStatus?"//0.htmlcomponentservice.com/":i)+e.relativeUrl;if("center"===e.align?n.style={display:"block",clear:"both",margin:"0 auto"}:n.style={float:e.align},n.src=o,n.sandbox="allow-scripts allow-same-origin allow-popups",this.props.siteData.isMobileView()&&e.dimsRatio){if(n.width="99%",e.dimsRatio>1){var r=.99*(this._getMediaRichTextComponentWidth()?parseInt(this._getMediaRichTextComponentWidth(),10):1)*e.dimsRatio;n.height=r}}else n.width=e.width;return t.createReactElement("iframe",f(n))},_handleMusicComp:function(n,i){var o=e.get(this.props.siteData,["serviceTopology","scriptsLocationMap","wix-music-embed"]),r=/^[\w\-]+$/i,a=r.test(n.paymentId)||""===n.paymentId;if(r.test(n.albumId)&&r.test(n.presetId)&&a)return i.src=o+"/index.html?albumId="+n.albumId+"&paymentsId="+n.paymentId+"&presetId="+n.presetId+"&playerId="+n.playerId+"&hideDetailedTrackInfo=true",this.props.siteData.isMobileView()&&(i.src+="&isMobile=true"),i.sandbox="allow-scripts allow-same-origin allow-popups",i.playerId=n.playerId,delete i.wixComp,i.width="100%",t.createReactElement(m,i)},componentWillUnmount:function(){this.props.siteData.clearMediaRichTextInnerComponents(this.props.id)}};return t.compRegistrar.register("wysiwyg.viewer.components.MediaRichText",C),C}.apply(t,i))||(e.exports=o)},1537:function(e,t,n){var i,o;i=[n(1538),n(0),n(1)],void 0===(o=function(e,t,n){"use strict";return t.forEach(e,function(e,t){e.errorName=t}),n.logger.register("mediaRichText","error",e),e}.apply(t,i))||(e.exports=o)},1538:function(e){e.exports={MEDIA_RICH_TEXT_WRONG_COMP_DATA:{errorCode:32e3,severity:"fatal",params:{p1:"wixCompJson",p2:"errorDesc",p3:"errorStack"}},MEDIA_RICH_TEXT_UNSUPPORTED_COMPONENT:{errorCode:32001,severity:"fatal",params:{p1:"wixCompJson"}},MEDIA_RICH_MISSING_COMPONENT_PLACEHOLDER:{errorCode:32002,severity:"fatal",params:{p1:"dataQuery"}}}},1539:function(e,t,n){var i,o;i=[n(0),n(1)],void 0===(o=function(e,t){"use strict";var n="wysiwyg.viewer.components.MatrixGallery",i="wysiwyg.viewer.skins.gallerymatrix.BlogMatrixGallery",o="wysiwyg.viewer.components.SlideShowGallery",r="skins.viewer.gallery.BlogSlideShow",a=[n,o],s=.75;function p(e){return e===n}function c(e){return e===o}function l(e,t){var n=e.width;return{width:n,height:function(e,t){var n=0;if(p(t.componentType)){var i=t.cols,o=t.rows,r=2*t.margin,a=Math.round((e-(i-1)*r)/i),l=s*a;n=Math.round(l*o)+(o-1)*r+26}else c(t.componentType)&&(n=Math.round(s*e));return n}(n,t),position:"relative"}}return{buildGalleryJsonFromCkData:function(n,o,a){var s=n.componentType,m=e.assign({dataQuery:n.dataQuery,propertyQuery:n.dataQuery,componentType:n.componentType,type:"Component",style:l(a,n),compData:{type:"ImageList",items:e.map(n.imageList,function(t){var n=e.get(o,t.dataQuery);return e.assign({},t,n,{type:"Image",id:t.id+t.uri,isRef:!1,metaData:{isHidden:!1,isPreset:!0,schemaVersion:"1.0"}})}),metaData:{isPreset:!0,schemaVersion:"1.0",isHidden:!1}}},function(e){var n={};return p(e.componentType)?n={skin:i,compProp:{type:"MatrixGalleryProperties",metaData:{schemaVersion:"1.0"},expandEnabled:!0,imageMode:e.fixedSize?"clipImage":"flexibleWidthFixed",numCols:e.cols,maxRows:e.rows,incRows:2,margin:2*e.margin,alignText:"left"}}:c(e.componentType)?n={skin:r,compProp:{autoplay:e.autoplay,autoplayInterval:e.autoplayInterval,bidirectional:!1,expandEnabled:!0,imageMode:"flexibleWidthFixed",metaData:{schemaVersion:"1.0"},reverse:!1,showAutoplay:!0,showCounter:!0,showExpand:!1,showNavigation:!0,showSocial:!1,transDuration:1,transition:"swipeHorizontal",type:"SlideShowGalleryProperties"}}:t.log.error("Unknown gallery type: "+e.componentType),n}(n));return c(s)&&(m.styleId=t.santaTypes.shortenStyleId(r)),p(s)&&(m.styleId=t.santaTypes.shortenStyleId(i)),m},isGalleryComponent:function(t){return e.includes(a,t)}}}.apply(t,i))||(e.exports=o)},1540:function(e,t,n){var i,o;i=[n(0)],void 0===(o=function(e){"use strict";return{getInitialState:function(){return{height:this.props.height}},onPlayerMessage:function(e){"resizeOfWixMusicIframe"===e.data.event&&e.data.playerId===this.props.playerId&&this.setState({height:e.data.size.maxHeight})},componentDidMount:function(){window.addEventListener("message",this.onPlayerMessage)},componentWillUnmount:function(){window.removeEventListener("message",this.onPlayerMessage)},getIframeProps:function(){return e.assign({},this.props,{height:this.state.height})}}}.apply(t,i))||(e.exports=o)},18:function(e,t){e.exports=a},2:function(e,t){e.exports=n},3:function(e,t){e.exports=i},37:function(e,t){e.exports=s},4:function(e,t){e.exports=o}})});
//# sourceMappingURL=mediaRichText.min.js.map